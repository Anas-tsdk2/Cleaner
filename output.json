# Data Cleaning Instructions

## 1. Preliminary Analysis

Analyze each row in the dataset as a whole, considering the context and relationships between cells.

## 2. Detailed Row Analysis

For each row, create a `<row_analysis>` block containing:
- Content of each cell in the row
- Cell type (Title, First Name, Last Name, etc.) and associated cleaning rules
- Inconsistencies or potential data quality issues
- Relationships between fields (e.g., email and name)
- Reconstruction plan if name/full name fields are missing

## 3. Cleaning Rules by Type

### Title (Civility)

#### Analysis Block Creation
Create a `<title_analysis>` block containing:
- First name analysis using French first names database for gender determination
- Cross-verification with:
  - Email prefix
  - Full name
  - Gender indicators in all fields

#### Confidence Scores
- **High (≥0.95)**
  - Multiple strong indicators align
  - E.g., unambiguous first name + matching email
- **Medium (0.8-0.94)**
  - Primary indicators present but some ambiguity
- **Low (<0.8)**
  - Conflicting indicators or insufficient data

#### Decision Rules
- Score <0.95: Flag for human review
- Normalize to "Madame"/"Monsieur" only if score ≥0.95
- Ambiguous first names (e.g., Dominique, Claude): Always flag for human review
- Preserve original title if conflict with high-confidence gender determination

## 4. Decision Log

Generate a `<decision_log>` block with:
- All evidence considered
- Confidence score calculation details
- Specific rules triggered
- Human review flags
- Justification for title changes or preservation

## 5. Output Format

```json
{
    "field": "Title",
    "original_value": string,
    "proposed_value": string | null,
    "confidence": float,
    "requires_human_review": boolean,
    "evidence": {
        "first_name_gender": string | null,
        "email_indicators": string | null,
        "other_fields_indicators": string[] | null
    },
    "decision_factors": string[],
    "notes": string
}
```

## Key Points
- Rigorous analysis required before modification
- Strict confidence thresholds
- Original data preservation when in doubt
- Mandatory detailed documentation
- Explicit flagging mechanism for review
- Structured output for audit and processing

## Implementation Examples

### Example 1: High Confidence Case

```json
{
    "field": "Title",
    "original_value": "M",
    "proposed_value": "Monsieur",
    "confidence": 0.98,
    "requires_human_review": false,
    "evidence": {
        "first_name_gender": "male (Jean)",
        "email_indicators": "jean.dupont@",
        "other_fields_indicators": ["M. in full name"]
    },
    "decision_factors": [
        "Unambiguous male first name",
        "Matching email prefix",
        "Consistent title in full name"
    ],
    "notes": "High confidence normalization from 'M' to 'Monsieur' based on multiple consistent indicators"
}
```

### Example 2: Ambiguous Case Requiring Review

```json
{
    "field": "Title",
    "original_value": "Madame",
    "proposed_value": null,
    "confidence": 0.75,
    "requires_human_review": true,
    "evidence": {
        "first_name_gender": "ambiguous (Dominique)",
        "email_indicators": "d.martin@",
        "other_fields_indicators": []
    },
    "decision_factors": [
        "Ambiguous first name",
        "Non-indicative email prefix",
        "No additional gender indicators"
    ],
    "notes": "Flagged for human review due to ambiguous first name and insufficient corroborating evidence"
}
```

### Example 3: Conflicting Information

```json
{
    "field": "Title",
    "original_value": "Madame",
    "proposed_value": null,
    "confidence": 0.60,
    "requires_human_review": true,
    "evidence": {
        "first_name_gender": "male (Antoine)",
        "email_indicators": "antoine.durand@",
        "other_fields_indicators": ["Madame in title"]
    },
    "decision_factors": [
        "Typically male first name",
        "Consistent email prefix",
        "Conflicting original title"
    ],
    "notes": "Flagged for human review due to conflict between typically male name/email and feminine title"
}
```

## Best Practices

1. **Multiple Evidence Sources**
   - Always use multiple indicators for gender determination
   - Weight evidence based on reliability
   - Document all sources considered

2. **Conservative Decision Making**
   - Default to human review when in doubt
   - Require high confidence for automated changes
   - Preserve original data when confidence is insufficient

3. **Comprehensive Logging**
   - Record all decision factors
   - Document evidence weights and calculations
   - Include clear justification for decisions

4. **Error Prevention**
   - Double-check ambiguous cases
   - Maintain list of known ambiguous names
   - Regular validation of decision patterns

5. **Quality Assurance**
   - Regular audit of automated decisions
   - Tracking of human review outcomes
   - Continuous refinement of confidence thresholds